{"version":3,"file":"gorizond-ui-0.1.9.umd.min.edit.js","mappings":"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","sources":["webpack://gorizond-ui-0.1.9/./edit/provisioning.gorizond.io.cluster.vue","webpack://gorizond-ui-0.1.9/./utils/gorizond.js","webpack://gorizond-ui-0.1.9/./edit/provisioning.gorizond.io.cluster.vue?697e","webpack://gorizond-ui-0.1.9/./edit/provisioning.gorizond.io.billing.vue","webpack://gorizond-ui-0.1.9/./edit/provisioning.gorizond.io.billing.vue?5cce"],"sourcesContent":["<template>\n  <div class=\"p-6 space-y-6\">\n    <Banner v-if=\"!loaded\" color=\"info\" label=\"Loading...\" />\n\n    <Card v-else :showActions=\"true\" :buttonAction=\"onSave\" :buttonText=\"mode === 'create' ? 'Create' : 'Save'\" :showHighlightBorder=\"false\">\n      <template v-slot:title>\n        <div class=\"type-title\">\n          <h3>{{ mode }} Gorizond Cluster</h3>\n        </div>\n      </template>\n\n      <template v-slot:body>\n        <div class=\"space-y-4\">\n          <!-- Входные поля -->\n          <LabeledInput\n              v-model:value=\"model.metadata.name\"\n              label=\"Cluster Name\"\n              placeholder=\"Enter cluster name\"\n              :required=\"mode === 'create'\"\n              :disabled=\"mode !== 'create'\"\n          />\n\n          <LabeledSelect\n              v-model:value=\"model.metadata.namespace\"\n              label=\"Workspace (Namespace)\"\n              :options=\"workspaces\"\n              option-label=\"label\"\n              option-key=\"value\"\n              :disabled=\"mode !== 'create'\"\n              :required=\"mode === 'create'\"\n          />\n\n          <LabeledSelect\n              :disabled=\"mode === 'view'\"\n              v-model:value=\"model.spec.kubernetesVersion\"\n              label=\"Kubernetes Version\"\n              :options=\"k8sVersions\"\n              required\n          />\n\n          <LabeledSelect\n              :disabled=\"mode === 'view'\"\n              v-model:value=\"model.spec.billing\"\n              label=\"Billing\"\n              :options=\"billingOptions\"\n              required\n          />\n        </div>\n      </template>\n    </Card>\n  </div>\n</template>\n\n<script>\nimport { Banner } from '@components/Banner';\nimport { LabeledInput } from '@components/Form/LabeledInput';\nimport { Card } from '@components/Card';\nimport LabeledSelect from '@shell/components/form/LabeledSelect';\nimport { createOrUpgradeGorizondCluster } from '../utils/gorizond';\n\nconst YOUR_PRODUCT_NAME = 'gorizond';\nexport default {\n  props: {\n    value: {\n      type: Object,\n      default: null\n    },\n    mode: {\n      type: String,\n      required: true\n    }\n  },\n\n  components: {\n    Banner,\n    Card,\n    LabeledInput,\n    LabeledSelect\n  },\n\n  data() {\n    return {\n      loaded: false,\n      model: null,\n      workspaces: [],\n      k8sVersions: [],\n      billingOptions: []\n    };\n  },\n\n  watch: {\n    'model.metadata.namespace': {\n      handler: async function(newNs, oldNs) {\n        if (!newNs || newNs === oldNs) {\n          return;\n        }\n        await this.loadBillings(newNs);\n        if (!this.billingOptions.find(o => o.value === this.model?.spec?.billing)) {\n          this.model.spec.billing = '-free';\n        }\n      }\n    }\n  },\n\n  async created() {\n    this.model = { ...this.value };\n    const releases = await this.$store.dispatch('management/request', { url: '/v1-k3s-release/releases' })\n\n    this.k8sVersions = releases.data.map(ws => ({\n      label: ws.id.replace('+', '-'),\n      value: ws.id.replace('+', '-')\n    }));\n\n    const workspaces = await this.$store.dispatch('management/findAll', {\n      type: 'management.cattle.io.fleetworkspace'\n    });\n\n    const sorted = workspaces.sort((a, b) =>\n        new Date(b.metadata.creationTimestamp) - new Date(a.metadata.creationTimestamp)\n    );\n\n    this.workspaces = sorted.map(ws => ({\n      label: ws.metadata.name,\n      value: ws.metadata.name\n    }));\n\n    // Load billings from the selected namespace (Fleet workspace)\n    if (this.model?.metadata?.namespace) {\n      await this.loadBillings(this.model.metadata.namespace);\n    }\n\n    if (this.mode === 'create') {\n      this.model.spec = {\n        kubernetesVersion: this.k8sVersions.at(-1).value,\n        billing: '-free'\n      };\n      this.model.metadata.namespace = this.workspaces[0].value;\n      await this.loadBillings(this.model.metadata.namespace);\n      // prepend 'free' and merge fetched billings\n      this.ensureFreeBilling();\n    } else {\n      // map empty API value to UI sentinel '-free'\n      if (!this.model.spec) this.model.spec = {};\n      if (!this.model.spec.billing || this.model.spec.billing === '') {\n        this.model.spec.billing = '-free';\n      }\n    }\n\n    this.loaded = true;\n  },\n\n  methods: {\n    async loadBillings(namespace) {\n      try {\n        const res = await this.$store.dispatch('cluster/request', {\n          url: `/apis/provisioning.gorizond.io/v1/namespaces/${ namespace }/billings`,\n          method: 'GET'\n        });\n\n        // Rancher store sometimes returns plain {data} or the object directly\n        const payload = res?.data || res;\n        const items = payload?.items || payload?.data || [];\n\n        const options = Array.isArray(items)\n          ? items.map((b) => ({ label: b.metadata?.name, value: b.metadata?.name }))\n          : [];\n\n        // filter empty options\n        const filtered = options.filter(o => o && o.value);\n        // UI sentinel for empty billing is '-free'\n        this.billingOptions = [{ label: 'free (free tier use)', value: '-free' }, ...filtered];\n      } catch (e) {\n        this.billingOptions = [{ label: 'free (free tier use)', value: '-free' }];\n      }\n    },\n    ensureFreeBilling() {\n      if (!this.billingOptions.find(o => o.value === '-free')) {\n        this.billingOptions.unshift({ label: 'free (free tier use)', value: '-free' });\n      }\n    },\n    async onSave() {\n      const clean = JSON.parse(JSON.stringify(this.model || {}));\n\n\n      try {\n        await createOrUpgradeGorizondCluster(\n            this.model.metadata.name,\n            this.model.metadata.namespace,\n            this.model.spec.kubernetesVersion,\n            (this.model.spec.billing === '-free' || !this.model.spec.billing) ? '' : this.model.spec.billing,\n            this.$store\n        );\n\n        this.$router.push({\n          name: `c-cluster-${ YOUR_PRODUCT_NAME }-resource`,\n          params: {\n            cluster: this.$route.params.cluster || '_',\n            resource: 'provisioning.gorizond.io.cluster'\n          }\n        });\n      } catch (err) {\n        this.$store.dispatch('growl/fromError', {\n          err,\n          title: 'Failed to create cluster'\n        }, { root: true });\n      }\n    }\n  }\n};\n</script>\n","/**\n * Creates or updates a Gorizond Cluster (CRD provisioning.gorizond.io.Cluster)\n *\n * @param {string} name - cluster name (metadata.name)\n * @param {string} namespace - namespace (Fleet workspace)\n * @param {string} kubernetesVersion - K3s version\n * @param {object} store - this.$store from the component\n */\nexport async function createOrUpgradeGorizondCluster(\n  name,\n  namespace,\n  kubernetesVersion,\n  billing,\n  store\n) {\n  const baseUrl = `/apis/provisioning.gorizond.io/v1/namespaces/${namespace}/clusters/${name}`;\n\n  try {\n    // Try to get the current object\n    await store.dispatch(\"cluster/request\", {\n      url: baseUrl,\n      method: \"GET\",\n    });\n\n    // If GET succeeds — object exists → PATCH\n\n    const billingForApi =\n      billing === \"-free\" ||\n      billing === \"\" ||\n      billing === null ||\n      billing === undefined\n        ? \"\"\n        : billing;\n    const patch = {\n      spec: {\n        kubernetesVersion,\n        billing: billingForApi,\n      },\n    };\n\n    await store.dispatch(\"cluster/request\", {\n      url: baseUrl,\n      method: \"PATCH\",\n      headers: {\n        \"Content-Type\": \"application/merge-patch+json\",\n      },\n      data: patch,\n    });\n    await store.dispatch(\"management/find\", {\n      type: \"provisioning.gorizond.io.cluster\",\n      id: `${namespace}/${name}`,\n      opt: { force: true },\n    });\n  } catch (err) {\n    if (err?.code === 404) {\n      // Object not found → create\n      const billingForApiCreate =\n        billing === \"-free\" ||\n        billing === \"\" ||\n        billing === null ||\n        billing === undefined\n          ? \"\"\n          : billing;\n      const body = {\n        apiVersion: \"provisioning.gorizond.io/v1\",\n        kind: \"Cluster\",\n        metadata: {\n          name,\n          namespace,\n        },\n        spec: {\n          kubernetesVersion,\n          billing: billingForApiCreate,\n        },\n      };\n\n      await store.dispatch(\"cluster/request\", {\n        url: `/apis/provisioning.gorizond.io/v1/namespaces/${namespace}/clusters`,\n        method: \"POST\",\n        data: body,\n      });\n\n      await store.dispatch(\"management/find\", {\n        type: \"provisioning.gorizond.io.cluster\",\n        id: `${namespace}/${name}`,\n        opt: { force: true },\n      });\n    } else {\n      throw err;\n    }\n  }\n}\n","import { render } from \"./provisioning.gorizond.io.cluster.vue?vue&type=template&id=aa4aaec2\"\nimport script from \"./provisioning.gorizond.io.cluster.vue?vue&type=script&lang=js\"\nexport * from \"./provisioning.gorizond.io.cluster.vue?vue&type=script&lang=js\"\n\nimport exportComponent from \"../../../node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render]])\n\nexport default __exports__","<template>\n  <div class=\"p-6 space-y-6\">\n    <Banner v-if=\"!loaded\" color=\"info\" label=\"Loading...\" />\n\n    <Card v-else :showActions=\"true\" :buttonAction=\"onSave\" :buttonText=\"mode === 'create' ? 'Create' : 'Save'\" :showHighlightBorder=\"false\">\n      <template v-slot:title>\n        <div class=\"type-title\">\n          <h3>{{ mode }} Billing</h3>\n        </div>\n      </template>\n\n      <template v-slot:body>\n        <div class=\"space-y-4\">\n          <LabeledInput\n              v-model:value=\"model.metadata.name\"\n              label=\"Billing Name\"\n              placeholder=\"Enter billing name\"\n              :required=\"mode === 'create'\"\n              :disabled=\"mode !== 'create'\"\n          />\n\n          <LabeledSelect\n              v-model:value=\"model.metadata.namespace\"\n              label=\"Workspace (Namespace)\"\n              :options=\"workspaces\"\n              option-label=\"label\"\n              option-key=\"value\"\n              :disabled=\"mode !== 'create'\"\n              :required=\"mode === 'create'\"\n          />\n        </div>\n      </template>\n    </Card>\n  </div>\n  </template>\n\n  <script>\n  import { Banner } from '@components/Banner';\n  import { LabeledInput } from '@components/Form/LabeledInput';\n  import { Card } from '@components/Card';\n  import LabeledSelect from '@shell/components/form/LabeledSelect';\n\n  const YOUR_PRODUCT_NAME = 'gorizond';\n  export default {\n    props: {\n      value: {\n        type: Object,\n        default: null\n      },\n      mode: {\n        type: String,\n        required: true\n      }\n    },\n\n    components: {\n      Banner,\n      Card,\n      LabeledInput,\n      LabeledSelect\n    },\n\n    data() {\n      return {\n        loaded: false,\n        model: null,\n        workspaces: []\n      };\n    },\n\n    async created() {\n      this.model = { ...this.value };\n\n      const workspaces = await this.$store.dispatch('management/findAll', {\n        type: 'management.cattle.io.fleetworkspace'\n      });\n\n      const sorted = workspaces.sort((a, b) =>\n          new Date(b.metadata.creationTimestamp) - new Date(a.metadata.creationTimestamp)\n      );\n\n      this.workspaces = sorted.map(ws => ({\n        label: ws.metadata.name,\n        value: ws.metadata.name\n      }));\n\n      if (this.mode === 'create') {\n        this.model = this.model || {};\n        this.model.metadata = this.model.metadata || {};\n        this.model.metadata.namespace = this.workspaces[0]?.value;\n      }\n\n      this.loaded = true;\n    },\n\n    methods: {\n      async onSave() {\n        const clean = JSON.parse(JSON.stringify(this.model || {}));\n\n        try {\n          if (this.mode === 'create') {\n            const body = {\n              apiVersion: 'provisioning.gorizond.io/v1',\n              kind: 'Billing',\n              metadata: {\n                name: clean.metadata.name,\n                namespace: clean.metadata.namespace\n              }\n            };\n            await this.$store.dispatch('cluster/request', {\n              url: `/apis/provisioning.gorizond.io/v1/namespaces/${ clean.metadata.namespace }/billings`,\n              method: 'POST',\n              data: body\n            });\n          }\n\n          this.$router.push({\n            name: `c-cluster-${ YOUR_PRODUCT_NAME }-resource`,\n            params: {\n              cluster: this.$route.params.cluster || '_',\n              resource: 'provisioning.gorizond.io.billing'\n            }\n          });\n        } catch (err) {\n          this.$store.dispatch('growl/fromError', {\n            err,\n            title: 'Failed to save billing'\n          }, { root: true });\n        }\n      }\n    }\n  };\n  </script>\n\n","import { render } from \"./provisioning.gorizond.io.billing.vue?vue&type=template&id=d6395f3e\"\nimport script from \"./provisioning.gorizond.io.billing.vue?vue&type=script&lang=js\"\nexport * from \"./provisioning.gorizond.io.billing.vue?vue&type=script&lang=js\"\n\nimport exportComponent from \"../../../node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render]])\n\nexport default __exports__"],"names":["class","_createElementBlock","_hoisted_1","$data","loaded","_createBlock","_component_Card","key","showActions","buttonAction","$options","onSave","buttonText","$props","mode","showHighlightBorder","title","_withCtx","_createElementVNode","_hoisted_2","_toDisplayString","body","_hoisted_3","_createVNode","_component_LabeledInput","value","model","metadata","name","_cache","$event","label","placeholder","required","disabled","_component_LabeledSelect","namespace","options","workspaces","spec","kubernetesVersion","k8sVersions","billing","billingOptions","_","_component_Banner","color","async","createOrUpgradeGorizondCluster","store","baseUrl","dispatch","url","method","billingForApi","undefined","patch","headers","data","type","id","opt","force","err","code","billingForApiCreate","apiVersion","kind","YOUR_PRODUCT_NAME","props","Object","default","String","components","Banner","Card","LabeledInput","LabeledSelect","watch","handler","newNs","oldNs","this","loadBillings","find","o","created","releases","$store","map","ws","replace","sorted","sort","a","b","Date","creationTimestamp","at","ensureFreeBilling","methods","res","payload","items","Array","isArray","filtered","filter","e","unshift","JSON","parse","stringify","$router","push","params","cluster","$route","resource","root","__exports__","render","clean"],"sourceRoot":""}