"use strict";(("undefined"!==typeof self?self:this)["webpackChunkgorizond_ui_0_1_9"]=("undefined"!==typeof self?self:this)["webpackChunkgorizond_ui_0_1_9"]||[]).push([[739],{3979:function(e,a,t){t.r(a),t.d(a,{default:function(){return g}});var o=t(9274);const i={class:"p-6 space-y-6"},l={class:"type-title"},s={class:"space-y-4"};function n(e,a,t,n,r,d){const c=(0,o.resolveComponent)("Banner"),m=(0,o.resolveComponent)("LabeledInput"),p=(0,o.resolveComponent)("LabeledSelect"),u=(0,o.resolveComponent)("Card");return(0,o.openBlock)(),(0,o.createElementBlock)("div",i,[r.loaded?((0,o.openBlock)(),(0,o.createBlock)(u,{key:1,showActions:!0,buttonAction:d.onSave,buttonText:"create"===t.mode?"Create":"Save",showHighlightBorder:!1},{title:(0,o.withCtx)((()=>[(0,o.createElementVNode)("div",l,[(0,o.createElementVNode)("h3",null,(0,o.toDisplayString)(t.mode)+" Gorizond Cluster",1)])])),body:(0,o.withCtx)((()=>[(0,o.createElementVNode)("div",s,[(0,o.createVNode)(m,{value:r.model.metadata.name,"onUpdate:value":a[0]||(a[0]=e=>r.model.metadata.name=e),label:"Cluster Name",placeholder:"Enter cluster name",required:"create"===t.mode,disabled:"create"!==t.mode},null,8,["value","required","disabled"]),(0,o.createVNode)(p,{value:r.model.metadata.namespace,"onUpdate:value":a[1]||(a[1]=e=>r.model.metadata.namespace=e),label:"Workspace (Namespace)",options:r.workspaces,"option-label":"label","option-key":"value",disabled:"create"!==t.mode,required:"create"===t.mode},null,8,["value","options","disabled","required"]),(0,o.createVNode)(p,{disabled:"view"===t.mode,value:r.model.spec.kubernetesVersion,"onUpdate:value":a[2]||(a[2]=e=>r.model.spec.kubernetesVersion=e),label:"Kubernetes Version",options:r.k8sVersions,required:""},null,8,["disabled","value","options"]),(0,o.createVNode)(p,{disabled:"view"===t.mode,value:r.model.spec.billing,"onUpdate:value":a[3]||(a[3]=e=>r.model.spec.billing=e),label:"Billing",options:r.billingOptions,required:""},null,8,["disabled","value","options"])])])),_:1},8,["buttonAction","buttonText"])):((0,o.openBlock)(),(0,o.createBlock)(c,{key:0,color:"info",label:"Loading..."}))])}var r=t(9980),d=t(64415),c=t(179),m=t(75552);async function p(e,a,t,o,i){const l=`/apis/provisioning.gorizond.io/v1/namespaces/${a}/clusters/${e}`;try{await i.dispatch("cluster/request",{url:l,method:"GET"});const s="-free"===o||""===o||null===o||void 0===o?"":o,n={spec:{kubernetesVersion:t,billing:s}};await i.dispatch("cluster/request",{url:l,method:"PATCH",headers:{"Content-Type":"application/merge-patch+json"},data:n}),await i.dispatch("management/find",{type:"provisioning.gorizond.io.cluster",id:`${a}/${e}`,opt:{force:!0}})}catch(s){if(404!==s?.code)throw s;{const l="-free"===o||""===o||null===o||void 0===o?"":o,s={apiVersion:"provisioning.gorizond.io/v1",kind:"Cluster",metadata:{name:e,namespace:a},spec:{kubernetesVersion:t,billing:l}};await i.dispatch("cluster/request",{url:`/apis/provisioning.gorizond.io/v1/namespaces/${a}/clusters`,method:"POST",data:s}),await i.dispatch("management/find",{type:"provisioning.gorizond.io.cluster",id:`${a}/${e}`,opt:{force:!0}})}}}const u="gorizond";var h={props:{value:{type:Object,default:null},mode:{type:String,required:!0}},components:{Banner:r.l,Card:c.Z,LabeledInput:d.o,LabeledSelect:m.A},data(){return{loaded:!1,model:null,workspaces:[],k8sVersions:[],billingOptions:[]}},watch:{"model.metadata.namespace":{handler:async function(e,a){e&&e!==a&&(await this.loadBillings(e),this.billingOptions.find((e=>e.value===this.model?.spec?.billing))||(this.model.spec.billing="-free"))}}},async created(){this.model={...this.value};const e=await this.$store.dispatch("management/request",{url:"/v1-k3s-release/releases"});this.k8sVersions=e.data.map((e=>({label:e.id.replace("+","-"),value:e.id.replace("+","-")})));const a=await this.$store.dispatch("management/findAll",{type:"management.cattle.io.fleetworkspace"}),t=a.sort(((e,a)=>new Date(a.metadata.creationTimestamp)-new Date(e.metadata.creationTimestamp)));this.workspaces=t.map((e=>({label:e.metadata.name,value:e.metadata.name}))),this.model?.metadata?.namespace&&await this.loadBillings(this.model.metadata.namespace),"create"===this.mode?(this.model.spec={kubernetesVersion:this.k8sVersions.at(-1).value,billing:"-free"},this.model.metadata.namespace=this.workspaces[0].value,await this.loadBillings(this.model.metadata.namespace),this.ensureFreeBilling()):(this.model.spec||(this.model.spec={}),this.model.spec.billing&&""!==this.model.spec.billing||(this.model.spec.billing="-free")),this.loaded=!0},methods:{async loadBillings(e){try{const a=await this.$store.dispatch("cluster/request",{url:`/apis/provisioning.gorizond.io/v1/namespaces/${e}/billings`,method:"GET"}),t=a?.data||a,o=t?.items||t?.data||[],i=Array.isArray(o)?o.map((e=>({label:e.metadata?.name,value:e.metadata?.name}))):[],l=i.filter((e=>e&&e.value));this.billingOptions=[{label:"free (free tier use)",value:"-free"},...l]}catch(a){this.billingOptions=[{label:"free (free tier use)",value:"-free"}]}},ensureFreeBilling(){this.billingOptions.find((e=>"-free"===e.value))||this.billingOptions.unshift({label:"free (free tier use)",value:"-free"})},async onSave(){JSON.parse(JSON.stringify(this.model||{}));try{await p(this.model.metadata.name,this.model.metadata.namespace,this.model.spec.kubernetesVersion,"-free"!==this.model.spec.billing&&this.model.spec.billing?this.model.spec.billing:"",this.$store),this.$router.push({name:`c-cluster-${u}-resource`,params:{cluster:this.$route.params.cluster||"_",resource:"provisioning.gorizond.io.cluster"}})}catch(e){this.$store.dispatch("growl/fromError",{err:e,title:"Failed to create cluster"},{root:!0})}}}},v=t(47433);const b=(0,v.A)(h,[["render",n]]);var g=b},59478:function(e,a,t){t.r(a),t.d(a,{default:function(){return b}});var o=t(9274);const i={class:"p-6 space-y-6"},l={class:"type-title"},s={class:"space-y-4"};function n(e,a,t,n,r,d){const c=(0,o.resolveComponent)("Banner"),m=(0,o.resolveComponent)("LabeledInput"),p=(0,o.resolveComponent)("LabeledSelect"),u=(0,o.resolveComponent)("Card");return(0,o.openBlock)(),(0,o.createElementBlock)("div",i,[r.loaded?((0,o.openBlock)(),(0,o.createBlock)(u,{key:1,showActions:!0,buttonAction:d.onSave,buttonText:"create"===t.mode?"Create":"Save",showHighlightBorder:!1},{title:(0,o.withCtx)((()=>[(0,o.createElementVNode)("div",l,[(0,o.createElementVNode)("h3",null,(0,o.toDisplayString)(t.mode)+" Billing",1)])])),body:(0,o.withCtx)((()=>[(0,o.createElementVNode)("div",s,[(0,o.createVNode)(m,{value:r.model.metadata.name,"onUpdate:value":a[0]||(a[0]=e=>r.model.metadata.name=e),label:"Billing Name",placeholder:"Enter billing name",required:"create"===t.mode,disabled:"create"!==t.mode},null,8,["value","required","disabled"]),(0,o.createVNode)(p,{value:r.model.metadata.namespace,"onUpdate:value":a[1]||(a[1]=e=>r.model.metadata.namespace=e),label:"Workspace (Namespace)",options:r.workspaces,"option-label":"label","option-key":"value",disabled:"create"!==t.mode,required:"create"===t.mode},null,8,["value","options","disabled","required"])])])),_:1},8,["buttonAction","buttonText"])):((0,o.openBlock)(),(0,o.createBlock)(c,{key:0,color:"info",label:"Loading..."}))])}var r=t(9980),d=t(64415),c=t(179),m=t(75552);const p="gorizond";var u={props:{value:{type:Object,default:null},mode:{type:String,required:!0}},components:{Banner:r.l,Card:c.Z,LabeledInput:d.o,LabeledSelect:m.A},data(){return{loaded:!1,model:null,workspaces:[]}},async created(){this.model={...this.value};const e=await this.$store.dispatch("management/findAll",{type:"management.cattle.io.fleetworkspace"}),a=e.sort(((e,a)=>new Date(a.metadata.creationTimestamp)-new Date(e.metadata.creationTimestamp)));this.workspaces=a.map((e=>({label:e.metadata.name,value:e.metadata.name}))),"create"===this.mode&&(this.model=this.model||{},this.model.metadata=this.model.metadata||{},this.model.metadata.namespace=this.workspaces[0]?.value),this.loaded=!0},methods:{async onSave(){const e=JSON.parse(JSON.stringify(this.model||{}));try{if("create"===this.mode){const a={apiVersion:"provisioning.gorizond.io/v1",kind:"Billing",metadata:{name:e.metadata.name,namespace:e.metadata.namespace}};await this.$store.dispatch("cluster/request",{url:`/apis/provisioning.gorizond.io/v1/namespaces/${e.metadata.namespace}/billings`,method:"POST",data:a})}this.$router.push({name:`c-cluster-${p}-resource`,params:{cluster:this.$route.params.cluster||"_",resource:"provisioning.gorizond.io.billing"}})}catch(a){this.$store.dispatch("growl/fromError",{err:a,title:"Failed to save billing"},{root:!0})}}}},h=t(47433);const v=(0,h.A)(u,[["render",n]]);var b=v}}]);
//# sourceMappingURL=gorizond-ui-0.1.9.umd.min.edit.js.map