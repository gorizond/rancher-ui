(("undefined"!==typeof self?self:this)["webpackChunkgorizond_ui_0_1_12"]=("undefined"!==typeof self?self:this)["webpackChunkgorizond_ui_0_1_12"]||[]).push([[739],{3979:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return v}});var o=a(9274);const i={class:"p-6 space-y-6"},n={class:"type-title"},r={class:"space-y-4"};function l(e,t,a,l,s,d){const c=(0,o.resolveComponent)("Banner"),p=(0,o.resolveComponent)("LabeledInput"),m=(0,o.resolveComponent)("LabeledSelect"),u=(0,o.resolveComponent)("Card");return(0,o.openBlock)(),(0,o.createElementBlock)("div",i,[s.loaded?((0,o.openBlock)(),(0,o.createBlock)(u,{key:1,showActions:!0,buttonAction:d.onSave,buttonText:"create"===a.mode?"Create":"Save",showHighlightBorder:!1},{title:(0,o.withCtx)((()=>[(0,o.createElementVNode)("div",n,[(0,o.createElementVNode)("h3",null,(0,o.toDisplayString)(a.mode)+" Gorizond Cluster",1)])])),body:(0,o.withCtx)((()=>[(0,o.createElementVNode)("div",r,[(0,o.createVNode)(p,{value:s.model.metadata.name,"onUpdate:value":t[0]||(t[0]=e=>s.model.metadata.name=e),label:"Cluster Name",placeholder:"Enter cluster name",required:"create"===a.mode,disabled:"create"!==a.mode},null,8,["value","required","disabled"]),(0,o.createVNode)(m,{value:s.model.metadata.namespace,"onUpdate:value":t[1]||(t[1]=e=>s.model.metadata.namespace=e),label:"Workspace (Namespace)",options:s.workspaces,"option-label":"label","option-key":"value",disabled:"create"!==a.mode,required:"create"===a.mode},null,8,["value","options","disabled","required"]),(0,o.createVNode)(m,{disabled:"view"===a.mode,value:s.model.spec.kubernetesVersion,"onUpdate:value":t[2]||(t[2]=e=>s.model.spec.kubernetesVersion=e),label:"Kubernetes Version",options:s.k8sVersions,required:""},null,8,["disabled","value","options"]),(0,o.createVNode)(m,{disabled:"view"===a.mode,value:s.model.spec.billing,"onUpdate:value":t[3]||(t[3]=e=>s.model.spec.billing=e),label:"Billing",options:s.billingOptions,required:""},null,8,["disabled","value","options"])])])),_:1},8,["buttonAction","buttonText"])):((0,o.openBlock)(),(0,o.createBlock)(c,{key:0,color:"info",label:"Loading..."}))])}var s=a(9980),d=a(64415),c=a(84937),p=a(75552);async function m(e,t,a,o,i){const n=`/apis/provisioning.gorizond.io/v1/namespaces/${t}/clusters/${e}`;try{await i.dispatch("cluster/request",{url:n,method:"GET"});const r="-free"===o||""===o||null===o||void 0===o?"":o,l={spec:{kubernetesVersion:a,billing:r}};await i.dispatch("cluster/request",{url:n,method:"PATCH",headers:{"Content-Type":"application/merge-patch+json"},data:l}),await i.dispatch("management/find",{type:"provisioning.gorizond.io.cluster",id:`${t}/${e}`,opt:{force:!0}})}catch(r){if(404!==r?.code)throw r;{const n="-free"===o||""===o||null===o||void 0===o?"":o,r={apiVersion:"provisioning.gorizond.io/v1",kind:"Cluster",metadata:{name:e,namespace:t},spec:{kubernetesVersion:a,billing:n}};await i.dispatch("cluster/request",{url:`/apis/provisioning.gorizond.io/v1/namespaces/${t}/clusters`,method:"POST",data:r}),await i.dispatch("management/find",{type:"provisioning.gorizond.io.cluster",id:`${t}/${e}`,opt:{force:!0}})}}}const u="gorizond";var h={props:{value:{type:Object,default:null},mode:{type:String,required:!0}},components:{Banner:s.l,Card:c.Z,LabeledInput:d.o,LabeledSelect:p.A},data(){return{loaded:!1,model:null,workspaces:[],k8sVersions:[],billingOptions:[]}},watch:{"model.metadata.namespace":{handler:async function(e,t){e&&e!==t&&(await this.loadBillings(e),this.billingOptions.find((e=>e.value===this.model?.spec?.billing))||(this.model.spec.billing="-free"))}}},async created(){this.model={...this.value};const e=await this.$store.dispatch("management/request",{url:"/v1-k3s-release/releases"});this.k8sVersions=e.data.map((e=>({label:e.id.replace("+","-"),value:e.id.replace("+","-")})));const t=await this.$store.dispatch("management/findAll",{type:"management.cattle.io.fleetworkspace"}),a=t.sort(((e,t)=>new Date(t.metadata.creationTimestamp)-new Date(e.metadata.creationTimestamp)));this.workspaces=a.map((e=>({label:e.metadata.name,value:e.metadata.name}))),this.model?.metadata?.namespace&&await this.loadBillings(this.model.metadata.namespace),"create"===this.mode?(this.model.spec={kubernetesVersion:this.k8sVersions.at(-1).value,billing:"-free"},this.model.metadata.namespace=this.workspaces[0].value,await this.loadBillings(this.model.metadata.namespace),this.ensureFreeBilling()):(this.model.spec||(this.model.spec={}),this.model.spec.billing&&""!==this.model.spec.billing||(this.model.spec.billing="-free")),this.loaded=!0},methods:{async loadBillings(e){try{const t=await this.$store.dispatch("cluster/request",{url:`/apis/provisioning.gorizond.io/v1/namespaces/${e}/billings`,method:"GET"}),a=t?.data||t,o=a?.items||a?.data||[],i=Array.isArray(o)?o.map((e=>({label:e.metadata?.name,value:e.metadata?.name}))):[],n=i.filter((e=>e&&e.value));this.billingOptions=[{label:"free (free tier use)",value:"-free"},...n]}catch(t){this.billingOptions=[{label:"free (free tier use)",value:"-free"}]}},ensureFreeBilling(){this.billingOptions.find((e=>"-free"===e.value))||this.billingOptions.unshift({label:"free (free tier use)",value:"-free"})},async onSave(){JSON.parse(JSON.stringify(this.model||{}));try{await m(this.model.metadata.name,this.model.metadata.namespace,this.model.spec.kubernetesVersion,"-free"!==this.model.spec.billing&&this.model.spec.billing?this.model.spec.billing:"",this.$store),this.$router.push({name:`c-cluster-${u}-resource`,params:{cluster:this.$route.params.cluster||"_",resource:"provisioning.gorizond.io.cluster"}})}catch(e){this.$store.dispatch("growl/fromError",{err:e,title:"Failed to create cluster"},{root:!0})}}}},g=a(47433);const b=(0,g.A)(h,[["render",l]]);var v=b},4976:function(e,t,a){var o=a(49360);o.__esModule&&(o=o.default),"string"===typeof o&&(o=[[e.id,o,""]]),o.locals&&(e.exports=o.locals);var i=a(74825).A;i("86893f82",o,!0,{sourceMap:!1,shadowMode:!1})},49360:function(e,t,a){"use strict";a.r(t);var o=a(36758),i=a.n(o),n=a(40935),r=a.n(n),l=r()(i());l.push([e.id,".card-container{border-radius:var(--border-radius);display:flex;flex-basis:40%;margin:10px;min-height:100px;padding:10px;box-shadow:0 0 20px var(--shadow)}.card-container.highlight-border{border-left:5px solid var(--primary)}.card-container:not(.top){align-items:top;flex-direction:row;justify-content:start}.card-container .card-wrap{width:100%}.card-container .card-body{color:var(--input-label);display:flex;flex-direction:column;justify-content:center}.card-container .card-actions{align-self:end;display:flex;padding-top:20px}.card-container .card-title{align-items:center;display:flex;width:100%}.card-container .card-title h5{margin:0}.card-container .card-title .flex-right{margin-left:auto}.card-container.card-sticky{overflow:hidden}.card-container.card-sticky .card-wrap{display:flex;flex-direction:column}.card-container.card-sticky .card-wrap .card-body{justify-content:flex-start;overflow:auto}.card-container.card-sticky .card-wrap>*{flex:0}.card-container.card-sticky .card-wrap .card-body{flex:1}",""]),t["default"]=l},59478:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return b}});var o=a(9274);const i={class:"p-6 space-y-6"},n={class:"type-title"},r={class:"space-y-4"};function l(e,t,a,l,s,d){const c=(0,o.resolveComponent)("Banner"),p=(0,o.resolveComponent)("LabeledInput"),m=(0,o.resolveComponent)("LabeledSelect"),u=(0,o.resolveComponent)("Card");return(0,o.openBlock)(),(0,o.createElementBlock)("div",i,[s.loaded?((0,o.openBlock)(),(0,o.createBlock)(u,{key:1,showActions:!0,buttonAction:d.onSave,buttonText:"create"===a.mode?"Create":"Save",showHighlightBorder:!1},{title:(0,o.withCtx)((()=>[(0,o.createElementVNode)("div",n,[(0,o.createElementVNode)("h3",null,(0,o.toDisplayString)(a.mode)+" Billing",1)])])),body:(0,o.withCtx)((()=>[(0,o.createElementVNode)("div",r,[(0,o.createVNode)(p,{value:s.model.metadata.name,"onUpdate:value":t[0]||(t[0]=e=>s.model.metadata.name=e),label:"Billing Name",placeholder:"Enter billing name",required:"create"===a.mode,disabled:"create"!==a.mode},null,8,["value","required","disabled"]),(0,o.createVNode)(m,{value:s.model.metadata.namespace,"onUpdate:value":t[1]||(t[1]=e=>s.model.metadata.namespace=e),label:"Workspace (Namespace)",options:s.workspaces,"option-label":"label","option-key":"value",disabled:"create"!==a.mode,required:"create"===a.mode},null,8,["value","options","disabled","required"])])])),_:1},8,["buttonAction","buttonText"])):((0,o.openBlock)(),(0,o.createBlock)(c,{key:0,color:"info",label:"Loading..."}))])}var s=a(9980),d=a(64415),c=a(84937),p=a(75552);const m="gorizond";var u={props:{value:{type:Object,default:null},mode:{type:String,required:!0}},components:{Banner:s.l,Card:c.Z,LabeledInput:d.o,LabeledSelect:p.A},data(){return{loaded:!1,model:null,workspaces:[]}},async created(){this.model={...this.value};const e=await this.$store.dispatch("management/findAll",{type:"management.cattle.io.fleetworkspace"}),t=e.sort(((e,t)=>new Date(t.metadata.creationTimestamp)-new Date(e.metadata.creationTimestamp)));this.workspaces=t.map((e=>({label:e.metadata.name,value:e.metadata.name}))),"create"===this.mode&&(this.model=this.model||{},this.model.metadata=this.model.metadata||{},this.model.metadata.namespace=this.workspaces[0]?.value),this.loaded=!0},methods:{async onSave(){const e=JSON.parse(JSON.stringify(this.model||{}));try{if("create"===this.mode){const t={apiVersion:"provisioning.gorizond.io/v1",kind:"Billing",metadata:{name:e.metadata.name,namespace:e.metadata.namespace}};await this.$store.dispatch("cluster/request",{url:`/apis/provisioning.gorizond.io/v1/namespaces/${e.metadata.namespace}/billings`,method:"POST",data:t})}this.$router.push({name:`c-cluster-${m}-resource`,params:{cluster:this.$route.params.cluster||"_",resource:"provisioning.gorizond.io.billing"}})}catch(t){this.$store.dispatch("growl/fromError",{err:t,title:"Failed to save billing"},{root:!0})}}}},h=a(47433);const g=(0,h.A)(u,[["render",l]]);var b=g},84937:function(e,t,a){"use strict";a.d(t,{Z:function(){return u}});var o=a(9274);const i={class:"card-wrap"},n={class:"card-title","data-testid":"card-title-slot"},r={class:"card-body","data-testid":"card-body-slot"},l={key:0,class:"card-actions","data-testid":"card-actions-slot"};function s(e,t,a,s,d,c){return(0,o.openBlock)(),(0,o.createElementBlock)("div",{id:"focus-trap-card-container-element",class:(0,o.normalizeClass)(["card-container",{"highlight-border":e.showHighlightBorder,"card-sticky":e.sticky}]),"data-testid":"card"},[(0,o.createElementVNode)("div",i,[(0,o.createElementVNode)("div",n,[(0,o.renderSlot)(e.$slots,"title",{},(()=>[(0,o.createTextVNode)((0,o.toDisplayString)(e.title),1)]))]),t[1]||(t[1]=(0,o.createElementVNode)("hr",null,null,-1)),(0,o.createElementVNode)("div",r,[(0,o.renderSlot)(e.$slots,"body",{},(()=>[(0,o.createTextVNode)((0,o.toDisplayString)(e.content),1)]))]),e.showActions?((0,o.openBlock)(),(0,o.createElementBlock)("div",l,[(0,o.renderSlot)(e.$slots,"actions",{},(()=>[(0,o.createElementVNode)("button",{class:"btn role-primary",onClick:t[0]||(t[0]=(...t)=>e.buttonAction&&e.buttonAction(...t))},(0,o.toDisplayString)(e.buttonText),1)]))])):(0,o.createCommentVNode)("",!0)])],2)}var d=a(82149),c=(0,o.defineComponent)({name:"Card",props:{title:{type:String,default:""},content:{type:String,default:""},buttonAction:{type:Function,default:()=>{}},buttonText:{type:String,default:"go"},showHighlightBorder:{type:Boolean,default:!0},showActions:{type:Boolean,default:!0},sticky:{type:Boolean,default:!1},triggerFocusTrap:{type:Boolean,default:!1}},setup(e){e.triggerFocusTrap&&(0,d.kS)("#focus-trap-card-container-element",{escapeDeactivates:!1,allowOutsideClick:!0})}}),p=(a(4976),a(47433));const m=(0,p.A)(c,[["render",s]]);var u=m}}]);
//# sourceMappingURL=gorizond-ui-0.1.12.umd.min.edit.js.map