{"version":3,"file":"gorizond-ui-0.1.3.umd.min.edit.js","mappings":"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","sources":["webpack://gorizond-ui-0.1.3/./edit/provisioning.gorizond.io.cluster.vue","webpack://gorizond-ui-0.1.3/./utils/gorizond.js","webpack://gorizond-ui-0.1.3/./edit/provisioning.gorizond.io.cluster.vue?697e"],"sourcesContent":["<template>\n  <div class=\"p-6 space-y-6\">\n    <Banner v-if=\"!loaded\" color=\"info\" label=\"Loading...\" />\n\n    <Card v-else :showActions=\"true\" :buttonAction=\"onSave\" :buttonText=\"mode === 'create' ? 'Create' : 'Save'\" :showHighlightBorder=\"false\">\n      <template v-slot:title>\n        <div class=\"type-title\">\n          <h3>{{ mode }} Gorizond Cluster</h3>\n        </div>\n      </template>\n\n      <template v-slot:body>\n        <div class=\"space-y-4\">\n          <!-- Входные поля -->\n          <LabeledInput\n              v-model:value=\"model.metadata.name\"\n              label=\"Cluster Name\"\n              placeholder=\"Enter cluster name\"\n              :required=\"mode === 'create'\"\n              :disabled=\"mode !== 'create'\"\n          />\n\n          <LabeledSelect\n              v-model:value=\"model.metadata.namespace\"\n              label=\"Workspace (Namespace)\"\n              :options=\"workspaces\"\n              option-label=\"label\"\n              option-key=\"value\"\n              :disabled=\"mode !== 'create'\"\n              :required=\"mode === 'create'\"\n          />\n\n          <LabeledSelect\n              :disabled=\"mode === 'view'\"\n              v-model:value=\"model.spec.kubernetesVersion\"\n              label=\"Kubernetes Version\"\n              :options=\"k8sVersions\"\n              required\n          />\n        </div>\n      </template>\n    </Card>\n  </div>\n</template>\n\n<script>\nimport { Banner } from '@components/Banner';\nimport { LabeledInput } from '@components/Form/LabeledInput';\nimport { Card } from '@components/Card';\nimport LabeledSelect from '@shell/components/form/LabeledSelect';\nimport { createOrUpgradeGorizondCluster } from '../utils/gorizond';\n\nconst YOUR_PRODUCT_NAME = 'gorizond';\nexport default {\n  props: {\n    value: {\n      type: Object,\n      default: null\n    },\n    mode: {\n      type: String,\n      required: true\n    }\n  },\n\n  components: {\n    Banner,\n    Card,\n    LabeledInput,\n    LabeledSelect\n  },\n\n  data() {\n    return {\n      loaded: false,\n      model: null,\n      workspaces: [],\n      k8sVersions: []\n    };\n  },\n\n  async created() {\n    this.model = { ...this.value };\n    const releases = await this.$store.dispatch('management/request', { url: '/v1-k3s-release/releases' })\n\n    this.k8sVersions = releases.data.map(ws => ({\n      label: ws.id.replace('+', '-'),\n      value: ws.id.replace('+', '-')\n    }));\n\n    const workspaces = await this.$store.dispatch('management/findAll', {\n      type: 'management.cattle.io.fleetworkspace'\n    });\n\n    const sorted = workspaces.sort((a, b) =>\n        new Date(b.metadata.creationTimestamp) - new Date(a.metadata.creationTimestamp)\n    );\n\n    this.workspaces = sorted.map(ws => ({\n      label: ws.metadata.name,\n      value: ws.metadata.name\n    }));\n\n    if (this.mode === 'create') {\n      this.model.spec = {\n        kubernetesVersion: this.k8sVersions.at(-1).value,\n      };\n      this.model.metadata.namespace = this.workspaces[0].value;\n    }\n\n    this.loaded = true;\n  },\n\n  methods: {\n    async onSave() {\n      const clean = JSON.parse(JSON.stringify(this.model || {}));\n\n\n      try {\n        await createOrUpgradeGorizondCluster(\n            this.model.metadata.name,\n            this.model.metadata.namespace,\n            this.model.spec.kubernetesVersion,\n            this.$store\n        );\n\n        this.$router.push({\n          name: `c-cluster-${ YOUR_PRODUCT_NAME }-resource-namespace-id`,\n          params: {\n            id: clean.metadata.name,\n            namespace: clean.metadata.namespace\n          }\n        });\n      } catch (err) {\n        this.$store.dispatch('growl/fromError', {\n          err,\n          title: 'Failed to create cluster'\n        }, { root: true });\n      }\n    }\n  }\n};\n</script>\n","/**\n * Creates or updates a Gorizond Cluster (CRD provisioning.gorizond.io.Cluster)\n *\n * @param {string} name - cluster name (metadata.name)\n * @param {string} namespace - namespace (Fleet workspace)\n * @param {string} kubernetesVersion - K3s version\n * @param {object} store - this.$store from the component\n */\nexport async function createOrUpgradeGorizondCluster(name, namespace, kubernetesVersion, store) {\n    const baseUrl = `/apis/provisioning.gorizond.io/v1/namespaces/${namespace}/clusters/${name}`;\n\n    try {\n        // Try to get the current object\n        await store.dispatch('cluster/request', {\n            url: baseUrl,\n            method: 'GET'\n        });\n        \n        // If GET succeeds — object exists → PATCH\n\n        const patch = {\n            spec: {\n                kubernetesVersion\n            }\n        };\n\n        await store.dispatch('cluster/request', {\n            url: baseUrl,\n            method: 'PATCH',\n            headers: {\n                'Content-Type': 'application/merge-patch+json'\n            },\n            data: patch\n        });\n\n    } catch (err) {\n        if (err?.code === 404) {\n            // Object not found → create\n            const body = {\n                apiVersion: 'provisioning.gorizond.io/v1',\n                kind: 'Cluster',\n                metadata: {\n                    name,\n                    namespace\n                },\n                spec: {\n                    kubernetesVersion\n                }\n            };\n\n            await store.dispatch('cluster/request', {\n                url: `/apis/provisioning.gorizond.io/v1/namespaces/${namespace}/clusters`,\n                method: 'POST',\n                data: body\n            });\n\n        } else {\n            throw err;\n        }\n    }\n}\n","import { render } from \"./provisioning.gorizond.io.cluster.vue?vue&type=template&id=2723074c\"\nimport script from \"./provisioning.gorizond.io.cluster.vue?vue&type=script&lang=js\"\nexport * from \"./provisioning.gorizond.io.cluster.vue?vue&type=script&lang=js\"\n\nimport exportComponent from \"../../../node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render]])\n\nexport default __exports__"],"names":["class","_createElementBlock","_hoisted_1","$data","loaded","_createBlock","_component_Card","key","showActions","buttonAction","$options","onSave","buttonText","$props","mode","showHighlightBorder","title","_withCtx","_createElementVNode","_hoisted_2","_toDisplayString","body","_hoisted_3","_createVNode","_component_LabeledInput","value","model","metadata","name","_cache","$event","label","placeholder","required","disabled","_component_LabeledSelect","namespace","options","workspaces","spec","kubernetesVersion","k8sVersions","_","_component_Banner","color","async","createOrUpgradeGorizondCluster","store","baseUrl","dispatch","url","method","patch","headers","data","err","code","apiVersion","kind","YOUR_PRODUCT_NAME","props","type","Object","default","String","components","Banner","Card","LabeledInput","LabeledSelect","created","this","releases","$store","map","ws","id","replace","sorted","sort","a","b","Date","creationTimestamp","at","methods","clean","JSON","parse","stringify","$router","push","params","root","__exports__","render"],"sourceRoot":""}